<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Learning IndexedDB</title>
  </head>
  <body>
    <script src="js/app/models/Negociacao.js"></script>
    <script>

      var connection;


      var openRequest = window.indexedDB.open( 'learningAdvancedJS', 3 );

      openRequest.onupgradeneeded = event => {
        console.log( 'cria ou altera um banco já existente' );

        let minhaConnection = event.target.result;

        if ( minhaConnection.objectStoreNames.contains( 'negociacoes' ) ) {
          minhaConnection.deleteObjectStore( 'negociacoes' );
        }

        minhaConnection.createObjectStore( 'negociacoes', { autoIncrement: true } );
      };

      openRequest.onsuccess = event => {
        console.log( 'Conexão obtida com sucesso' );

        connection = event.target.result;
      };

      openRequest.onerror = event => {
        console.log( event.target.error );
      };

      function adiciona() {
        let transaction = connection.transaction( [ 'negociacoes' ], 'readwrite' );

        let store = transaction.objectStore( 'negociacoes' );

        let negociacao = new Negociacao( new Date(), 1, 200 );

        let request = store.add( negociacao );

        request.onsuccess = event => {
          console.log('Negociacao incluida com sucesso');
        };

        request.onerror = event => {
          console.log('não foi possível incluid a negociacao');
        };
      }


    </script>
  </body>
</html>
